var b=Object.defineProperty;var L=(n,t,e)=>t in n?b(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>L(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();const o=50,x=13,M=13,A=[[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,0,0,0,0,0,1,1,0,0],[0,0,1,0,0,1,1,1,0,0,1,0,0],[0,0,1,0,0,0,0,0,0,0,1,0,0],[0,0,1,0,0,1,1,1,0,0,1,0,0],[0,0,1,1,0,0,0,0,0,1,1,0,0],[1,0,0,0,1,1,0,1,1,0,0,0,1],[0,0,1,1,0,0,0,0,0,1,1,0,0],[0,0,1,0,0,1,1,1,0,0,1,0,0],[0,0,1,0,0,0,0,0,0,0,1,0,0],[0,0,1,1,0,1,1,1,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0,0,0,0,0]],D=A.map(n=>n.map(t=>({type:t,hp:t===1?3:void 0})));function R(n){for(let t=0;t<x;t++)for(let e=0;e<M;e++){const s=D[t][e];if(s.type===1){const l=1-(s.hp??0)/3,c=Math.floor(163+92*l),S=Math.floor(51+136*l),B=Math.floor(51+136*l);n.fillStyle=`rgb(${c}, ${S}, ${B})`,n.fillRect(e*o,t*o,o,o)}s.type===2&&(n.fillStyle="#0af",n.fillRect(e*o,t*o,o,o))}}const H={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]};class W{constructor(t,e,s,i=1){h(this,"x");h(this,"y");h(this,"direction");h(this,"speed",5);h(this,"damage");h(this,"active",!0);h(this,"onExplode");this.x=t+o/4,this.y=e+o/4,this.direction=s,this.damage=i}update(){var l;const[t,e]=H[this.direction];this.x+=t*this.speed,this.y+=e*this.speed;const s=Math.floor(this.x/o),i=Math.floor(this.y/o);if(s<0||i<0||s>=M||i>=x){this.active=!1;return}const r=D[i][s];r.type===1&&(r.hp=Math.max(0,(r.hp??0)-this.damage),r.hp<=0&&(r.type=0,r.hp=void 0),this.active=!1,(l=this.onExplode)==null||l.call(this,s*o,i*o))}draw(t){this.active&&(t.fillStyle="#ff0",t.beginPath(),t.arc(this.x+o/4,this.y+o/4,o/6,0,Math.PI*2),t.fill())}}const O={up:[0,-1],down:[0,1],left:[-1,0],right:[1,0]},y=class y{constructor(t,e){h(this,"x");h(this,"y");h(this,"direction","up");h(this,"speed",2);h(this,"firePower",1);h(this,"cooldownMax",20);h(this,"cooldown",0);h(this,"alive",!0);h(this,"hp",3);h(this,"maxHp",3);h(this,"bullets",[]);h(this,"moving",!1);h(this,"moveProgress",0);this.x=t,this.y=e}getBullets(){return this.bullets}getDelta(){return O[this.direction]}shoot(){if(this.cooldown>0)return;const t=new W(this.x,this.y,this.direction,this.firePower);t.onExplode=(e,s)=>{var i;(i=y.handleExplosion)==null||i.call(y,e,s)},this.bullets.push(t),this.cooldown=this.cooldownMax}updateBullets(){this.cooldown=Math.max(0,this.cooldown-1),this.bullets=this.bullets.filter(t=>t.active),this.bullets.forEach(t=>t.update())}takeDamage(t){return this.hp-=t,this.hp<=0?(this.alive=!1,!0):!1}collidesWithMap(t,e){const s=Math.floor(t/o),i=Math.floor(e/o);if(s<0||i<0||s>=M||i>=x)return!0;const r=D[i][s];return r.type===1||r.type===2}collidesWithTanks(t,e,s){for(const i of s){if(i===this||!i.alive)continue;const r=Math.abs(t-i.x),l=Math.abs(e-i.y);if(r<o&&l<o)return!0}return!1}drawBase(t,e){t.fillStyle=e,t.fillRect(this.x,this.y,o,o);const s=this.x+o/2,i=this.y+o/2;this.drawBarrel(t,s,i),this.drawHpBar(t),this.bullets.forEach(r=>r.draw(t))}drawHpBar(t){if(this.hp>=this.maxHp||this.maxHp<=1)return;const e=o,s=4,i=Math.max(0,this.hp/this.maxHp);let r=i<.5?255:Math.floor(255*(1-i)*2),l=i>.5?255:Math.floor(255*i*2);const S=`rgb(${r}, ${l}, 50)`;t.fillStyle="#000",t.fillRect(this.x,this.y-s-2,e,s),t.fillStyle=S,t.fillRect(this.x,this.y-s-2,e*i,s)}drawBarrel(t,e,s){t.fillStyle="#222";const i=o/2,r=o/6;switch(this.direction){case"up":t.fillRect(e-r/2,this.y-i/4,r,i);break;case"down":t.fillRect(e-r/2,this.y+o-i+i/4,r,i);break;case"left":t.fillRect(this.x-i/4,s-r/2,i,r);break;case"right":t.fillRect(this.x+o-i+i/4,s-r/2,i,r);break}}};h(y,"handleExplosion");let w=y;const u={up:new Set(["w","W","ц","Ц","ArrowUp"]),down:new Set(["s","S","ы","Ы","ArrowDown"]),left:new Set(["a","A","ф","Ф","ArrowLeft"]),right:new Set(["d","D","в","В","ArrowRight"]),shoot:new Set([" ","Space"])};class $ extends w{constructor(e,s){super(e,s);h(this,"hp",3);h(this,"speed",4);h(this,"cooldownMax",10)}update(e,s){this.alive&&([...u.shoot].some(i=>e.has(i))&&(u.shoot.forEach(i=>e.delete(i)),this.shoot()),this.moving?this.continueMove():[...u.up].some(i=>e.has(i))?this.tryMove("up",s):[...u.down].some(i=>e.has(i))?this.tryMove("down",s):[...u.left].some(i=>e.has(i))?this.tryMove("left",s):[...u.right].some(i=>e.has(i))&&this.tryMove("right",s),this.updateBullets())}tryMove(e,s){this.direction=e;const[i,r]=this.getDelta(),l=this.x+i*o,c=this.y+r*o;!this.collidesWithMap(l,c)&&!this.collidesWithTanks(l,c,s)&&(this.moving=!0,this.moveProgress=0)}continueMove(){const[e,s]=this.getDelta();this.x+=e*this.speed,this.y+=s*this.speed,this.moveProgress+=this.speed,this.moveProgress>=o&&(this.x=Math.round(this.x/o)*o,this.y=Math.round(this.y/o)*o,this.moving=!1)}draw(e){this.alive&&this.drawBase(e,"#0f0")}}class m extends w{constructor(e,s){super(e,s);h(this,"speed",1);h(this,"hp",3);h(this,"onDeath");this.direction=this.randomDirection()}update(e,s){this.alive&&(this.moving?this.continueMove():(Math.random()<.02&&(this.direction=this.randomDirection()),this.tryMove(s)),Math.random()<.01&&this.cooldown===0&&this.shoot(),this.updateBullets(),this.checkHit(e.getBullets()))}tryMove(e){const[s,i]=this.getDelta(),r=this.x+s*o,l=this.y+i*o;!this.collidesWithMap(r,l)&&!this.collidesWithTanks(r,l,e)?(this.moving=!0,this.moveProgress=0):this.direction=this.randomDirection()}continueMove(){const[e,s]=this.getDelta();this.x+=e*this.speed,this.y+=s*this.speed,this.moveProgress+=this.speed,this.moveProgress>=o&&(this.x=Math.round(this.x/o)*o,this.y=Math.round(this.y/o)*o,this.moving=!1)}checkHit(e){for(const s of e){if(!s.active)continue;const i=this.x+16-(s.x+8),r=this.y+16-(s.y+8);if(Math.sqrt(i*i+r*r)<o/2){const c=this.takeDamage(s.damage);s.active=!1,c&&this.onDeath&&this.onDeath(this.x,this.y);return}}}draw(e){this.alive&&this.drawBase(e,"#f00")}randomDirection(){const e=["up","down","left","right"];return e[Math.floor(Math.random()*e.length)]}}class v{constructor(t,e){h(this,"x");h(this,"y");h(this,"lifetime",15);this.x=t,this.y=e}update(){this.lifetime--}get isAlive(){return this.lifetime>0}draw(t){const e=this.lifetime/15,s=o*(1.2-e);t.save(),t.globalAlpha=e,t.fillStyle="#ff6",t.beginPath(),t.arc(this.x+o/2,this.y+o/2,s,0,Math.PI*2),t.fill(),t.restore()}}const g=document.getElementById("game"),p=g.getContext("2d");g.width=o*x;g.height=o*M;const E=new Set,a=new $(6*o,12*o),f=[new m(0*o,0),new m(3*o,0),new m(6*o,0),new m(9*o,0),new m(12*o,0)];let d=[];w.handleExplosion=(n,t)=>d.push(new v(n,t));f.forEach(n=>{n.onDeath=(t,e)=>d.push(new v(t,e))});document.addEventListener("keydown",n=>{E.add(n.key)});document.addEventListener("keyup",n=>{E.delete(n.key)});window.addEventListener("blur",()=>E.clear());function P(){I(),k(),requestAnimationFrame(P)}function I(){a.update(E,f),f.forEach(n=>n.update(a,[a,...f])),f.forEach(n=>{n.getBullets().forEach(t=>{if(!t.active||!a.alive)return;const e=a.x+o/2-(t.x+o/4),s=a.y+o/2-(t.y+o/4);if(Math.sqrt(e*e+s*s)<o/2&&a.alive){const r=a.takeDamage(t.damage);t.active=!1,r&&d.push(new v(a.x,a.y))}})}),a.getBullets().forEach(n=>{f.forEach(t=>{t.getBullets().forEach(e=>{if(!n.active||!e.active)return;const s=n.x+8-(e.x+8),i=n.y+8-(e.y+8);if(Math.sqrt(s*s+i*i)<8){n.active=!1,e.active=!1;const l=(n.x+e.x)/2,c=(n.y+e.y)/2;d.push(new v(l,c))}})})}),d=d.filter(n=>n.isAlive),d.forEach(n=>n.update())}function k(){p.fillStyle="#333",p.fillRect(0,0,g.width,g.height),R(p),d.forEach(n=>n.draw(p)),a.draw(p),f.forEach(n=>n.draw(p))}P();
